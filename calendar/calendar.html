<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dynamic Calendar</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
  h1 { text-align: center; }
  .calendar { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; }
  .day, .empty { background: white; border: 1px solid #ddd; min-height: 80px; padding: 5px; font-size: 14px; position: relative; }
  .empty { background: #f0f0f0; }
  .day-number { font-weight: bold; }
  .event { background: #87cefa; font-size: 12px; border-radius: 4px; }
  .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-weight: bold; margin-top: 10px; }
  .form-container { text-align: center; margin: 20px auto; }
  input, select, button { margin: 5px; padding: 5px; }
</style>
</head>
<body>

<h1 id="calendar-title"></h1>

<div class="form-container">
  <!-- Month/Year selectors added dynamically -->
  <input type="text" id="eventText" placeholder="Event description">
  <select id="eventDay"></select>
  <button onclick="addEvent()">Add Event</button>
  <button onclick="downloadPDF()">Download PDF</button>
  <button onclick="showHelp()">?</button> <!-- New help button -->
</div>

<div id="calendar-container">
  <div class="weekdays">
    <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
  </div>
  <div class="calendar" id="calendar"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script>
let selectedYear = 2025;
let selectedMonth = 8; // September (0-indexed)
const calendar = document.getElementById("calendar");
const eventDaySelect = document.getElementById("eventDay");
const calendarTitle = document.getElementById("calendar-title");

const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];

// Build month/year dropdowns
function buildSelectors() {
  const monthSelect = document.createElement("select");
  const yearSelect = document.createElement("select");

  for (let m=0; m<12; m++){
    const option = document.createElement("option");
    option.value = m; option.textContent = monthNames[m];
    if (m === selectedMonth) option.selected = true;
    monthSelect.appendChild(option);
  }
  for (let y=2023; y<=2030; y++){
    const option = document.createElement("option");
    option.value = y; option.textContent = y;
    if (y === selectedYear) option.selected = true;
    yearSelect.appendChild(option);
  }

  monthSelect.addEventListener("change",()=>{ selectedMonth=parseInt(monthSelect.value); renderCalendar(); });
  yearSelect.addEventListener("change",()=>{ selectedYear=parseInt(yearSelect.value); renderCalendar(); });

  const container = document.querySelector(".form-container");
  container.prepend(yearSelect);
  container.prepend(monthSelect);
}

// Render calendar grid
function renderCalendar() {
  calendar.innerHTML = "";
  eventDaySelect.innerHTML = "";

  const daysInMonth = new Date(selectedYear, selectedMonth+1, 0).getDate();
  const firstDayOfWeek = new Date(selectedYear, selectedMonth, 1).getDay();

  calendarTitle.textContent = `${monthNames[selectedMonth]} ${selectedYear} Calendar`;

  // Empty cells
  for (let i=0;i<firstDayOfWeek;i++){
    const emptyBox = document.createElement("div");
    emptyBox.classList.add("empty");
    calendar.appendChild(emptyBox);
  }

  // Days + dropdown
  for (let i=1;i<=daysInMonth;i++){
    const dayBox = document.createElement("div");
    dayBox.classList.add("day"); dayBox.id = `day-${i}`;
    const dayNumber = document.createElement("div"); dayNumber.classList.add("day-number"); dayNumber.textContent = i;
    dayBox.appendChild(dayNumber); calendar.appendChild(dayBox);

    const option = document.createElement("option"); option.value=i; option.textContent=`Day ${i}`;
    eventDaySelect.appendChild(option);
  }

  loadSavedEvents();
}

// Add event
function addEvent() {
  const text = document.getElementById("eventText").value.trim();
  const day = document.getElementById("eventDay").value;
  if (!text) return;

  const eventDiv = document.createElement("div");
  eventDiv.classList.add("event");
  eventDiv.style.display="flex"; eventDiv.style.justifyContent="space-between"; eventDiv.style.alignItems="center"; eventDiv.style.padding="2px 5px"; eventDiv.style.marginTop="3px";

  const textSpan = document.createElement("span");
  textSpan.textContent = text;
  eventDiv.appendChild(textSpan);

  const deleteBtn = document.createElement("button");
  deleteBtn.innerHTML = "ðŸ—‘";
  deleteBtn.style.border="none"; deleteBtn.style.background="transparent"; deleteBtn.style.cursor="pointer";
  deleteBtn.onclick = ()=>{ eventDiv.remove(); saveEventsToStorage(); };
  eventDiv.appendChild(deleteBtn);

  const dayBox = document.getElementById(`day-${day}`);
  if (dayBox) dayBox.appendChild(eventDiv);

  document.getElementById("eventText").value = "";
  saveEventsToStorage();
}

// Load saved events with delete button
function loadSavedEvents() {
  const saved = localStorage.getItem(`calendar-${selectedYear}-${selectedMonth}`);
  if (!saved) return;
  const events = JSON.parse(saved);

  events.forEach(ev=>{
    const eventDiv = document.createElement("div");
    eventDiv.classList.add("event");
    eventDiv.style.display="flex"; eventDiv.style.justifyContent="space-between"; eventDiv.style.alignItems="center"; eventDiv.style.padding="2px 5px"; eventDiv.style.marginTop="3px";

    const textSpan = document.createElement("span"); textSpan.textContent=ev.text; eventDiv.appendChild(textSpan);

    const deleteBtn = document.createElement("button");
    deleteBtn.innerHTML="ðŸ—‘"; deleteBtn.style.border="none"; deleteBtn.style.background="transparent"; deleteBtn.style.cursor="pointer";
    deleteBtn.onclick=()=>{ eventDiv.remove(); saveEventsToStorage(); };
    eventDiv.appendChild(deleteBtn);

    const dayBox = document.getElementById(`day-${ev.day}`);
    if(dayBox) dayBox.appendChild(eventDiv);
  });
}

// Save events
function saveEventsToStorage() {
  const daysInMonth = new Date(selectedYear, selectedMonth+1, 0).getDate();
  const events = [];
  for(let i=1;i<=daysInMonth;i++){
    const dayBox = document.getElementById(`day-${i}`);
    if(!dayBox) continue;
    dayBox.querySelectorAll(".event").forEach(evDiv=>{
      const text = evDiv.querySelector("span").textContent;
      events.push({day:i, text:text});
    });
  }
  localStorage.setItem(`calendar-${selectedYear}-${selectedMonth}`, JSON.stringify(events));
}

// Download PDF
function downloadPDF() {
  const element = document.getElementById("calendar-container");

  // 1. Add temporary title
  const tempTitle = document.createElement("h2");
  tempTitle.textContent = `${monthNames[selectedMonth]} ${selectedYear} Calendar`;
  tempTitle.style.textAlign = "center";
  tempTitle.style.marginBottom = "10px";
  element.prepend(tempTitle);

  // 2. Hide all delete buttons temporarily
  const deleteButtons = element.querySelectorAll(".event button");
  deleteButtons.forEach(btn => btn.style.display = "none");

  // 3. PDF options
  const fileName = `${monthNames[selectedMonth]}-${selectedYear}-Calendar.pdf`;
  const opt = {
    margin: 0.5,
    filename: fileName,
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'in', format: 'letter', orientation: 'landscape' }
  };

  // 4. Generate PDF
  html2pdf().from(element).set(opt).save().then(() => {
    // 5. Remove temporary title
    tempTitle.remove();
    // 6. Show delete buttons again
    deleteButtons.forEach(btn => btn.style.display = "inline");
  });
}

function showHelp() {
  alert(
    "How to use the calendar:\n\n" +
    "1. Select the month and year at the top.\n" +
    "2. Enter an event description and choose the day, then click 'Add Event'.\n" +
    "3. Click the trash icon ðŸ—‘ next to an event to delete it.\n" +
    "4. Click 'Download PDF' to save a PDF of the calendar.\n\n" +
    "Note: Events are stored locally in your browser, so your history will remember them even after refreshing the page."
  );
}

// Initialize
buildSelectors();
renderCalendar();
</script>
</body>
</html>
